<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Customer Feedback Analyzer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>Customer Feedback Analyzer</h1>
    <p>Sentiment â€¢ Star Rating â€¢ Emotion</p>
  </header>

  <main>
    <section class="card">
      <form action="/analyze" method="post" enctype="multipart/form-data" class="grid">
        <div class="form-group">
          <label>Enter a single feedback (text)</label>
          <textarea name="text" placeholder="Type or paste customer feedback here..."></textarea>
        </div>
        <div class="or">â€” or â€”</div>
        <div class="form-group">
          <label>Upload CSV (must include a <code>text</code> column)</label>
          <input type="file" name="file" accept=".csv"/>
        </div>
        <button class="btn" type="submit">Analyze</button>
        <a class="link" href="/json" target="_blank">JSON API quick start</a>
      </form>
      {% if error %}
        <div class="error">{{ error }}</div>
      {% endif %}
    </section>

    {% if results %}
    <section class="card">
      <details open>
        <summary>Show Results ({{ results|length }})</summary>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Text</th>
                <th>Sentiment</th>
                <th>Score</th>
                <th>Rating</th>
                <th>Emotion</th>
                <th>Distribution</th>
              </tr>
            </thead>
            <tbody>
              {% for r in results %}
              <tr>
                <td>{{ loop.index }}</td>
                <td class="text-cell">{{ r.text }}</td>
                <td>
                  <span class="pill">{{ r.sentiment }}</span>
                </td>
                <td>{{ "%.2f"|format(r.sentiment_score*100) }}%</td>
                <td>
                  {% if r.rating_stars %}
                    {{ "â˜…"|repeat(r.rating_stars) }}{{ "â˜†"|repeat(5 - r.rating_stars) }}
                    <small>({{ r.rating_stars }}/5)</small>
                  {% else %}
                    â€”
                  {% endif %}
                </td>
                <td>
                  <span class="pill emo">{{ EMOJI.get(r.emotion, "ðŸŽ¯") }} {{ r.emotion|capitalize }}</span>
                  <small>{{ "%.2f"|format(r.emotion_score*100) }}%</small>
                </td>
                <td class="dist">
                  {% for k, v in r.emotion_dist.items() %}
                    <span title="{{ k }}">{{ k[0]|upper }}</span> {{ "%.0f"|format(v*100) }}{% if not loop.last %}, {% endif %}
                  {% endfor %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    </section>
    {% endif %}
  </main>

  <footer>
    <small>Models: cardiffnlp/twitter-roberta-base-sentiment-latest â€¢ nlptown/bert-base-multilingual-uncased-sentiment â€¢ bhadresh-savani/distilbert-base-uncased-emotion</small>
  </footer>
</body>
</html>
