<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Customer Feedback Analyzer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>Customer Feedback Analyzer</h1>
    <p>Sentiment • Star Rating • Emotion</p>
  </header>

  <main>
    <section class="card">
      <form action="/analyze" method="post" enctype="multipart/form-data" class="grid">
        <div class="form-group">
          <label>Enter a single feedback (text)</label>
          <textarea name="text" placeholder="Type or paste customer feedback here..."></textarea>
        </div>
        <div class="or">— or —</div>
        <div class="form-group">
          <label>Upload CSV (any delimiter; malformed rows auto-skipped)</label>
          <input type="file" name="file" accept=".csv"/>
        </div>
        <button class="btn" type="submit">Analyze</button>
        <a class="link" href="/json" target="_blank">JSON API quick start</a>
      </form>

      {% if messages %}
        <ul class="messages">
          {% for m in messages %}
            <li>{{ m }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </section>

    {% if results %}
    <section class="card">
      <details open>
        <summary>Show Results ({{ results|length }})</summary>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Text</th>
                <th>Sentiment</th>
                <th>Confidence</th>
                <th>Rating</th>
                <th>Emotion</th>
                <!--<th>Top-3 Emotions</th>-->
              </tr>
            </thead>
            <tbody>
              {% for r in results %}
              <tr>
                <td>{{ loop.index }}</td>
                <td class="text-cell">{{ r.text }}</td>
                <td><span class="pill">{{ r.sentiment }}</span></td>
                <td>{{ "%.2f"|format(r.sentiment_score*100) }}%</td>
                <td>
                  {{ r.stars_display }}
                  {% if r.rating_stars %}<small>({{ r.rating_stars }}/5)</small>{% endif %}
                </td>
                <td>
                  <span class="pill emo">{{ r.emotion_emoji }} {{ r.emotion_label }}</span>
                  <small>{{ "%.2f"|format(r.emotion_score*100) }}%</small>
                </td>
                <td class="dist">
                  {% for lbl, prob in r.emotion_top3 %}
                    <span class="dist-chip">{{ lbl.capitalize() }}</span> {{ "%.0f"|format(prob*100) }}{% if not loop.last %}, {% endif %}
                  {% endfor %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    </section>
    {% endif %}
  </main>

  <footer>
    <small>
      Models: cardiffnlp/twitter-roberta-base-sentiment-latest •
      nlptown/bert-base-multilingual-uncased-sentiment •
      bhadresh-savani/distilbert-base-uncased-emotion
    </small>
  </footer>
</body>
</html>
